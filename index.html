<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Travel Invoice Generator</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
</head>
<body>
    <div class="mountain-bg"></div>
    
    <div class="container">
        <h1>Yara Service Invoice Generator</h1>
        
        <div class="app-container">
            <div class="form-container">
                <h2>Enter Invoice Details</h2>
                <form id="invoiceForm">
                    <div class="form-section">
                        <h3>Your Company Details</h3>
                        <div class="form-group">
                            <label for="companyName">Company Name</label>
                            <input type="text" id="companyName" value="Yara Services" required>
                        </div>
                        <div class="form-group">
                            <label for="companyAddress">Company Address</label>
                            <textarea id="companyAddress" required>5th Mile Lumsey, Tadong beside Hotel Lumsey Inn, Gangtok, Sikkim - 737101</textarea>
                        </div>
                        <div class="form-group">
                            <label for="companyPhone">Phone Number</label>
                            <input type="text" id="companyPhone" value="+91 9883023091" required>
                        </div>
                        <div class="form-group">
                            <label for="companyEmail">Email</label>
                            <input type="email" id="companyEmail" value="support@yaraservice.com" required>
                        </div>
                        <div class="form-group">
                            <label for="companyGST">GSTIN</label>
                            <input type="text" id="companyGST" value="22AAAAA0000A1Z5">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Client Information</h3>
                        <div class="form-group">
                            <label for="clientName">Client Name</label>
                            <input type="text" id="clientName" required>
                        </div>
                        <div class="form-group">
                            <label for="clientAddress">Client Address</label>
                            <textarea id="clientAddress" required></textarea>
                        </div>
                        <div class="form-group">
                            <label for="clientGST">Client GSTIN (Optional)</label>
                            <input type="text" id="clientGST">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Invoice Details</h3>
                        <div class="form-group">
                            <label for="invoiceNumber">Invoice Number</label>
                            <input type="text" id="invoiceNumber" value="INV-001-2025-01" required>
                        </div>
                        <div class="form-group">
                            <label for="invoiceDate">Invoice Date</label>
                            <input type="date" id="invoiceDate" required>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Invoice Items</h3>
                        <div id="itemsList">
                            <div class="item-row">
                                <div class="form-group">
                                    <label>Item Description</label>
                                    <input type="text" class="item-description" required>
                                </div>
                                <div class="form-group">
                                    <label>Price (₹)</label>
                                    <input type="number" class="item-price" required>
                                </div>
                                <div class="form-group">
                                    <label>Qty</label>
                                    <input type="number" class="item-qty" value="1" required>
                                </div>
                                <button type="button" class="remove-item">✕</button>
                            </div>
                        </div>
                        <button type="button" id="addItemBtn">+ Add Item</button>
                    </div>

                    <div class="form-section">
                        <h3>Additional Details</h3>
                        <div class="form-group">
                            <label for="taxRate">Tax Rate (%)</label>
                            <input type="number" id="taxRate" value="18">
                        </div>
                        <div class="form-group">
                            <label for="discountAmount">Discount Amount (Optional)</label>
                            <input type="number" id="discountAmount" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="advancePayment">Advance Payment (Optional)</label>
                            <input type="number" id="advancePayment" value="0" min="0">
                        </div>
                        <div class="form-group">
                            <label for="bankName">Bank Name</label>
                            <input type="text" id="bankName" value="Canara Bank">
                        </div>
                        <div class="form-group">
                            <label for="accountNumber">Account Number</label>
                            <input type="text" id="accountNumber" value="120033745630">
                        </div>
                        <div class="form-group">
                            <label for="ifscCode">IFSC Code</label>
                            <input type="text" id="ifscCode" value="CNRB00019411">
                        </div>
                        <div class="form-group">
                            <label for="termsConditions">Terms & Conditions</label>
                            <textarea id="termsConditions">Please contact us if any issues occur in 14 working days.</textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="generateInvoice">Generate Invoice</button>
                    </div>
                </form>
            </div>

            <div class="preview-container" id="invoicePreview">
                <div class="invoice-actions">
                    <button type="button" id="downloadPDF">Download as PDF</button>
                    <button type="button" id="backToForm">Edit Invoice</button>
                </div>
                
                <!-- Add wrapper for consistent mobile viewing -->
                <div class="invoice-wrapper">
                    <div class="invoice" id="invoice">
                        <div class="invoice-header">
                            <div class="company-info">
                                <img src="https://i.ibb.co/9m1t8ytv/Untitled-design-4.png" alt="Company Logo" class="logo">
                                <h2 id="preview-companyName">SEMPURNA Travel & Tours</h2>
                            </div>
                            <div class="invoice-title">
                                <h1>INVOICE</h1>
                                <p id="preview-invoiceNumber"># INV-001-2025-01</p>
                            </div>
                        </div>
                        
                        <div class="invoice-details">
                            <div class="company-details">
                                <p id="preview-companyAddress">123 Mountain View, Adventure Road, Travel City</p>
                                <p>Phone: <span id="preview-companyPhone">+91 123 456 7890</span></p>
                                <p>Email: <span id="preview-companyEmail">support@yaraservice.com</span></p>
                                <p>GSTIN: <span id="preview-companyGST">22AAAAA0000A1Z5</span></p>
                            </div>
                            <div class="invoice-info">
                                <div class="date-info">
                                    <p><strong>Date:</strong> <span id="preview-invoiceDate">01/01/2025</span></p>
                                </div>
                                <div class="client-info">
                                    <p><strong>INVOICE TO:</strong></p>
                                    <p id="preview-clientName">Client Name</p>
                                    <p id="preview-clientAddress">Client Address</p>
                                    <p id="preview-clientGSTLabel">GSTIN: <span id="preview-clientGST"></span></p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="invoice-items">
                            <table>
                                <thead>
                                    <tr>
                                        <th>NO.</th>
                                        <th>Item Description</th>
                                        <th>Price</th>
                                        <th>Qty.</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody id="preview-items">
                                    <!-- Items will be added here dynamically -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="invoice-summary">
                            <div class="thanks-message">
                                <h3>Thank you for your business</h3>
                                <div class="contact-info">
                                    <div><span class="icon">📞</span> <span id="preview-companyPhone2">+91 9883023091</span></div>
                                    <div><span class="icon">📧</span> <span id="preview-companyEmail2">support@yaraservice.com</span></div>
                                </div>
                            </div>
                            <div class="totals">
                                <div class="subtotal-row">
                                    <span>Sub total</span>
                                    <span id="preview-subtotal">₹0.00</span>
                                </div>
                                <div class="tax-row">
                                    <span>Tax (<span id="preview-taxRate">18</span>%)</span>
                                    <span id="preview-tax">₹0.00</span>
                                </div>
                                <div id="discount-row" class="discount-row" style="display: none;">
                                    <span>Discount</span>
                                    <span id="preview-discount">₹0.00</span>
                                </div>
                                <div class="total-row">
                                    <span>Total</span>
                                    <span id="preview-total">₹0.00</span>
                                </div>
                                <div id="advance-row" class="advance-row" style="display: none;">
                                    <span>Advance Payment</span>
                                    <span id="preview-advance">₹0.00</span>
                                </div>
                                <div id="balance-row" class="balance-row" style="display: none;">
                                    <span>Balance Due</span>
                                    <span id="preview-balance">₹0.00</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="invoice-footer">
                            <div class="payment-info">
                                <h3>PAYMENT METHOD</h3>
                                <div class="payment-details">
                                    <div class="bank-details">
                                        <p><span class="icon">🏦</span> <span id="preview-bankName">Travel Bank of India</span></p>
                                        <p>Acc: <span id="preview-accountNumber">1234567890</span></p>
                                        <p>IFSC: <span id="preview-ifscCode">TRBI0001234</span></p>
                                    </div>
                                    <div class="upi-qr">
                                        <img src="https://i.ibb.co/r2WyrJkV/Whats-App-Image-2025-04-25-at-13-33-27.jpg" alt="UPI QR Code">
                                        <p>Scan to pay</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="terms-section">
                                <h3>TERMS & CONDITIONS</h3>
                                <p id="preview-termsConditions">Please contact us if any issues occur in 14 working days.</p>
                            </div>
                        </div>
                        
                        <div class="signature-section">
                            <img src="https://i.ibb.co/Y40ck28f/Whats-App-Image-2025-04-25-at-13-34-44.jpg" alt="Signature">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add an additional fallback PDF script -->
    <script>
        // Improved fallback PDF generator
        window.addEventListener('load', function() {
            // Check if the download button has an event listener
            if (!document.getElementById('downloadPDF').onclick) {
                document.getElementById('downloadPDF').addEventListener('click', function() {
                    // Check if PDF library is loaded
                    if (typeof html2pdf === 'undefined') {
                        alert('PDF generation library not loaded. Please check your internet connection and try again.');
                        return;
                    }
                    
                    const downloadBtn = this;
                    downloadBtn.textContent = 'Generating PDF...';
                    downloadBtn.disabled = true;
                    
                    // Get the invoice element
                    const element = document.getElementById('invoice');
                    
                    // Simple, reliable PDF options
                    const options = {
                        margin: 10,
                        filename: 'Yara_Services_Invoice.pdf',
                        image: { type: 'jpeg', quality: 1 },
                        html2canvas: { 
                            scale: 2, 
                            useCORS: true,
                            logging: false
                        },
                        jsPDF: { 
                            unit: 'mm', 
                            format: 'a4', 
                            orientation: 'portrait' 
                        }
                    };
                    
                    // Generate and download PDF
                    html2pdf()
                        .from(element)
                        .set(options)
                        .save()
                        .then(() => {
                            console.log('PDF generated successfully');
                        })
                        .catch((err) => {
                            console.error('PDF generation error:', err);
                            alert('There was an error generating the PDF. Please try again.');
                        })
                        .finally(() => {
                            downloadBtn.textContent = 'Download as PDF';
                            downloadBtn.disabled = false;
                        });
                });
            }
        });
    </script>
    
    <!-- Make sure to load images before generating PDF -->
    <script>
        // Preload all invoice images
        window.addEventListener('load', function() {
            const invoiceImages = document.querySelectorAll('#invoice img');
            invoiceImages.forEach(img => {
                // Force image loading
                const newImg = new Image();
                newImg.src = img.src;
            });
        });
    </script>
    
    <!-- Ensure script is loaded correctly -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="script.js"></script>
</body>
</html>
